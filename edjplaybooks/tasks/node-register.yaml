- name: stop dns service
  shell: systemctl stop systemd-resolved
  tags: dnsservice
- name: update dns record
  shell: echo "nameserver 1.1.1.1" > /etc/resolv.conf
  tags: dnsrecord
- name: node register
  shell: |
          ip=$(wget -q -O - ipinfo.io/ip)
          edjx genkeys --priv {{ CERTIFICATES }}/private.pem --pub {{ CERTIFICATES }}/public.pem
          edjx node init {{ CERTIFICATES }}/private.pem
          edjx node gencsr {{ CERTIFICATES }}/private.pem -o {{ CERTIFICATES }}/csr.pem
          edjx node createcert {{ CERTIFICATES }}/csr.pem -c {{ CERTIFICATES }}/cert.pem
          edjx node gen-env {{ CERTIFICATES }}/private.pem -i $ip -o runtime/.env -w {{ WRITER_NODE_ID }} -b {{ BOOTSTRAP_NODE_ADDRESS }} --dns --greedy --{{ BOOTSTRAP }}
          sed -i '/^\s*$/d' runtime/.env
          cd runtime 
          edjx node start
  register: noderegister
- debug:
     msg: "{{ noderegister.stdout }}"
